# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem              1.0
PortGroup               github 1.0

github.setup            verilator verilator 4.202 v
revision                1
categories              science electronics
license                 {LGPL-3 Artistic-2}
maintainers             {mcalhoun @MarcusCalhoun-Lopez} openmaintainer
platforms               darwin
description             Verilog compiler and simulator
long_description        Verilator is a {*}${description}.

checksums               rmd160  613bc0c4924245f128ff3845aabafb7dc98c6c12 \
                        sha256  53faa192b313779017ddc73537ecfd16d208ce5a12004a218842bdb9d414d550 \
                        size    2353074

compiler.cxx_standard   2014

use_autoconf            yes

installs_libs           no

depends_lib-append      port:perl5.34
configure.perl          ${prefix}/bin/perl5.34

depends_build-append    port:flex
configure.env-append    LEX=${prefix}/bin/flex

depends_build-append    port:bison
configure.env-append    YACC=${prefix}/bin/bison

depends_build-append    port:python310
configure.python        ${prefix}/bin/python3.10
configure.env-append    PYTHON3=${configure.python}

post-patch {
    foreach fl {verilator verilator_coverage verilator_difftree verilator_gantt verilator_includer verilator_profcfunc} {
        reinplace "s|^#!/usr/bin/env perl\$|#!${configure.perl}|" ${worksrcpath}/bin/${fl}
    }
}

#!@PREFIX@/bin/bash

# stub script, which initiates update via touch
# usage: update-mime-database mime_path

dir_prefix="@PREFIX@"
dir_bin="${dir_prefix}/bin"
dir_mime="${dir_prefix}/share/mime"
dir_mime_pkgs="${dir_mime}/packages"
bin_grealpath="${dir_bin}/grealpath"

arg_count=${#}
#printf "arg_count: ${arg_count}\n"

if [[ ${arg_count} -lt 1 ]]; then
    printf "Usage: ${0} mime_path\n"
    exit 1
fi

# mime_path must be last argument; ignore previous args, if any, like -V
arg_path="${@: -1}"
#printf "${0}: arg_path: ${arg_path}\n"

arg_path_full="$(${bin_grealpath} -q ${arg_path})"
if [ $? -ne 0 ]; then
    printf "${0}: mime_path does not exist: ${arg_path}\n"
    exit 1
fi

#printf "${0}: arg_path_full: ${arg_path_full}\n"

dir_mime_full="$(${bin_grealpath} ${dir_mime})"
if [ $? -ne 0 ]; then
    printf "${0}: dir_mime does not exist: ${dir_mime}\n"
    exit 1
fi

#printf "${0}: dir_mime_full: ${dir_mime_full}\n"

if [[ "${arg_path_full}" == "${dir_mime_full}"* ]]; then
    #printf "${0}: mime_path matches dir_mime_full; running touch\n"
    touch "${dir_mime_pkgs}"
else
    printf "${0}: mime_path does not match ${dir_mime}; ignoring\n"
fi

exit 0

